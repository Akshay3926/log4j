package com.nt.jdbc;

import java.sql.Connection;
import java.util.Date;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import org.apache.log4j.ConsoleAppender;
import org.apache.log4j.Level;
import org.apache.log4j.Logger;
import org.apache.log4j.SimpleLayout;

public class SelectTest {
   private static final String GET_ALL_STUDENTS_QUERY="SELECT SNO,SNAME,SADD,AVG FROM STUDENT";
   
	//create logger
	private static Logger logger=Logger.getLogger(com.nt.jdbc.SelectTest.class);
	
	public static void main(String[] args) {
	SimpleLayout layout=null;
	ConsoleAppender appender=null;
	Connection con=null;
	PreparedStatement ps=null;
	ResultSet rs=null;
	boolean flag=false;
	
	//create layout
	layout=new SimpleLayout();
	//create Appender
	appender=new ConsoleAppender();
	//add appender
	logger.addAppender(appender);
	//specify logger level to retrieve log messages
	logger.setLevel(Level.ALL);
	logger.info("Log4J app Started");
	
	try {
		//register driver
		Class.forName("oracle.jdbc.driver.OracleDriver");
		logger.debug("driver registered");
		
		//establish the connection
		con=DriverManager.getConnection("jdbc:oracle:thin:@localhost:1521:orcl");
		logger.debug("connection established");
		
		//create Prepared statement object
		if(con!=null) {
			ps=con.prepareStatement(GET_ALL_STUDENTS_QUERY);
		logger.debug("prepared statement obj is created");
		}
		//send and execute sql query
		if(ps!=null) {
			rs=ps.executeQuery();
		logger.debug("resultsetobj is created");
		}
		//process the resultset
		if(rs!=null) {
			while(rs.next()) {
				System.out.println(rs.getInt(1)+" "+rs.getString(2)+" "+rs.getString(3)+" "+rs.getFloat(4));
			}//while
		logger.debug("resultset object is processed");
		}//if
        if(flag==false) {
        	System.out.println("record  not found");
        	logger.info("table empty"+new Date());
        }
        else {
        	System.out.println("record found");
        }
		
		
		
	}
}
}
